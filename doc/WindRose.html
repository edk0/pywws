<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
  <head>
    <title>
      Software for WeatherStations: WindRose.py
    </title>
  </head>
  <body>
    <h1>
      <a href="index.html">Python software for USB Wireless WeatherStations</a>
    </h1>
    <h2>
      <a href="auto/WindRose.html">WindRose.py</a> -- draw a "wind rose" using an XML recipe
    </h2>
    <p>
      This routine plots one or more "wind roses" (see <a href="http://en.wikipedia.org/wiki/Wind_rose">Wikipedia</a> for a description). Like <a href="Plot.html">Plot.py</a> almost everything is controlled by an XML "recipe" / template file.
    </p>
    <p>
      Before writing your own template files, it might be useful to look at some of the examples in the <a href="../example_graph_templates/">example_graph_templates directory</a>. If (like I was) you are unfamiliar with XML, I suggest reading the <a href="http://www.w3schools.com/xml/">W3 Schools XML tutorial</a>.
    </p>
    <h2>
      XML graph file syntax
    </h2>
    <p>
      Here is the simplest useful wind rose template. It plots wind over the last 24 hours.
    </p>
<pre>
&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;graph&gt;
  &lt;windrose&gt;
    &lt;ycalc&gt;data['wind_ave']&lt;/ycalc&gt;
  &lt;/windrose&gt;
&lt;/graph&gt;
</pre>
    <p>
      In this example, the root element <code>graph</code> has one <code>windrose</code> element which contains nothing more than a <code>ycalc</code> element.
    </p>
    <p>
      The complete element hierarchy is shown below. Each element name links to a full description of that element.
    </p>
    <ul>
      <li>
        <a name="list"></a><a href="#graph">graph</a> 
        <ul>
          <li>
            <a href="#windrose">windrose</a> 
            <ul>
              <li>
                <a href="#xcalc">xcalc</a>
              </li>
              <li>
                <a href="#ycalc">ycalc</a>
              </li>
              <li>
                <a href="#threshold">threshold</a>
              </li>
              <li>
                <a href="#colour">colour</a>
              </li>
              <li>
                <a href="#yrange">yrange</a>
              </li>
              <li>
                <a href="#points">points</a>
              </li>
              <li>
                <a href="#source">source</a>
              </li>
              <li>
                <a href="#title2">title</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="#start">start</a>
          </li>
          <li>
            <a href="#stop">stop</a>
          </li>
          <li>
            <a href="#duration">duration</a>
          </li>
          <li>
            <a href="#layout">layout</a>
          </li>
          <li>
            <a href="#size">size</a>
          </li>
          <li>
            <a href="#fileformat">fileformat</a>
          </li>
          <li>
            <a href="#title1">title</a>
          </li>
        </ul>
      </li>
    </ul>
    <h3>
      <a href="#list" name="graph">graph</a>
    </h3>
    <p>
      This is the root element of the graph XML file. It does not have to be called "graph", but there must be exactly one root element.
    </p>
    <h3>
      <a href="#list" name="windrose">windrose</a>
    </h3>
    <p>
	A separate plot is drawn for each windrose element, but all share the same time period.
    </p>
    <h3>
      <a href="#list" name="start">start</a>
    </h3>
    <p>
      This element sets the date &amp; time of the wind roses. It is used in the constructor of a Python <a href="auto/datetime.html#datetime">datetime</a> object. For example, to start at noon (local time) on Christmas day: <code>&lt;start&gt;year=2008, month=12, day=25, hour=12&lt;/start&gt;</code>. The default value is <code>(stop - duration)</code>.
    </p>
    <h3>
      <a href="#list" name="stop">stop</a>
    </h3>
    <p>
      This element sets the date &amp; time of the end of the wind roses. It is used in the constructor of a Python <a href="auto/datetime.html#datetime">datetime</a> object. For example, to end at 10 am (local time) on new year's day: <code>&lt;stop&gt;year=2009, month=1, day=1, hour=10&lt;/stop&gt;</code>. The default value is <code>(start + duration)</code>, unless <code>start</code> is not defined in which case the timestamp of the latest weather station hourly reading is used.
    </p>
    <h3>
      <a href="#list" name="duration">duration</a>
    </h3>
    <p>
      This element sets the duration of wind roses, unless both <code>start</code> and <code>stop</code> are defined. It is used in the constructor of a Python <a href="auto/datetime.html#timedelta">timedelta</a> object. For example, to plot one week: <code>&lt;duration&gt;weeks=1&lt;/duration&gt;</code>. The default value is <code>hours=24</code>.
    </p>
    <h3>
      <a href="#list" name="layout">layout</a>
    </h3>
    <p>
      Controls the layout of the plots. Default is a grid that is wider than it is tall. The <code>layout</code> element specifies rows and columns. For example: <code>&lt;layout&gt;4, 2&lt;/layout&gt;</code> will use a grid of 4 rows and 2 columns.
    </p>
    <h3>
      <a href="#list" name="size">size</a>
    </h3>
    <p>
      Sets the overall dimensions of the image file containing the graph. Default is a height of 600 pixels and a width that depends on the layout. Any <code>size</code> element must include both width and height. For example: <code>&lt;size&gt;800, 600&lt;/size&gt;</code> will produce an image 800 pixels wide and 600 pixels high.
    </p>
    <h3>
      <a href="#list" name="fileformat">fileformat</a>
    </h3>
    <p>
      Sets the image format of the file containing the plots. Default is png. Any string recognised by your installation of gnuplot should do. For example: <code>&lt;fileformat&gt;gif&lt;/fileformat&gt;</code> will produce a GIF image.
    </p>
    <h3>
      <a href="#list" name="title1">title</a>
    </h3>
    <p>
      Sets the overall title of the plots. A single line of text, for example: <code>&lt;title&gt;Today's weather&lt;/title&gt;</code>. This title appears at the very top, outside any plot area.
    </p>
    <h3>
      <a href="#list" name="xcalc">xcalc</a>
    </h3>
    <p>
	Selects if data is included in the wind rose. The value should be a valid Python logical expression. For example, to plot a rose for afternoon winds only: <code>&lt;xcalc&gt;data['idx'].hour &amp;gt;= 12&lt;/xcalc&gt;</code>. This allows aggregation of afternoon wind data over several days. Remember that data is indexed in UTC, so you need to use an expression that takes account of your time zone. The default value is 'True'.
    </p>
    <h3>
      <a href="#list" name="ycalc">ycalc</a>
    </h3>
    <p>
	Selects the data to be plotted. Any one line Python expression that returns a single float value can be used. At its simplest this just selects one value from the "data" dictionary, for example: <code>&lt;ycalc&gt;data['wind_ave']&lt;/ycalc&gt;</code>. To convert to mph use: <code>&lt;ycalc&gt;data['wind_ave'] * 3.6 / 1.609344&lt;/ycalc&gt;</code>. You are unlikely to want to use anything other than 'wind_ave' here.
    </p>
    <h3>
      <a href="#list" name="threshold">threshold</a>
    </h3>
    <p>
      Sets the thresholds for each colour on the rose petals. Defaults are based on the <a href="http://en.wikipedia.org/wiki/File:Wind_rose_plot.jpg">Wikipedia example</a>. The values should be a correctly ordered list of real numbers, for example: <code>&lt;threshold&gt;0.5, 3.5, 7.5, 12.5, 18.5, 24.5, 31.5&lt;/threshold&gt;</code> approximates to the Beaufort scale, if <code>ycalc</code> has been set to convert windspeeds to mph.
    </p>
    <h3>
      <a href="#list" name="colour">colour</a>
    </h3>
    <p>
      Sets the colours of the threshold petal segments. Any sequence of integer values is accepted. The mapping of colours to numbers is set by <a href="http://www.gnuplot.info/">gnuplot</a>. Default value is 0, 1, 2, 3, etc.
    </p>
    <h3>
      <a href="#list" name="yrange">yrange</a>
    </h3>
    <p>
      Sets the upper limits of the axes. The rose shows what percentage of the time the wind came from a particular direction. For example, if you live somewhere with a very steady wind you might want to allow higher percentages than normal: <code>&lt;yrange&gt;91&lt;/yrange&gt;</code>.
    </p>
    <h3>
      <a href="#list" name="points">points</a>
    </h3>
    <p>
      Sets the text of the compass points. The defaults are 'N', 'S', 'E' &amp; 'W'. For graphs in another language you can over-ride this, for example: <code>&lt;points&gt;'No', 'Zu', 'Oo', 'We'&lt;/points&gt;</code>.
    </p>
    <h3>
      <a href="#list" name="source">source</a>
    </h3>
    <p>
      Select the weather data to be plotted. Permitted values are <code>&lt;source&gt;raw&lt;/source&gt;</code>, <code>&lt;source&gt;hourly&lt;/source&gt;</code>, <code>&lt;source&gt;daily&lt;/source&gt;</code> and <code>&lt;source&gt;monthly&lt;/source&gt;</code>. Default is <code>raw</code>. Note that the different sources have different data dictionaries, so this choice affects <code>ycalc</code>.
    </p>
    <h3>
      <a href="#list" name="title2">title</a>
    </h3>
    <p>
      Sets the title of the plot. A single line of text, for example: <code>&lt;title&gt;Morning winds&lt;/title&gt;</code>. This title appears within the plot area, above the threshold colour key.
    </p>
    <hr>
    <p>
      <a href="http://code.google.com/p/pywws/"><i>Python software for USB Wireless WeatherStations</i></a> &copy; <a href="http://www.jim-easterbrook.me.uk/">Jim Easterbrook</a>.
    </p>
  </body>
</html>