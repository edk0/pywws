<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
  <head>
    <title>
      Software for WeatherStations: Plot.py
    </title>
  </head>
  <body>
    <h1>
      <a href="index.html">Python software for USB Wireless WeatherStations</a>
    </h1>
    <h2>
      <a href="auto/Plot.html">Plot.py</a> -- plots graph using an XML template
    </h2>
    <p>
      Like <a href="Template.html">Template.py</a> this is one of the more difficult to use modules in the weather station software collection. It plots a graph (or set of graphs) of weather data. Almost everything about the graph is controlled by an XML file. I refer to these files as templates, but they aren't templates in the same sense as Template.py uses to create text files.
    </p>
    <p>
      Before writing your own graph template files, it might be useful to look at some of the examples in the <a href="../example_graph_templates/">example_graph_templates directory</a>. If (like I was) you are unfamiliar with XML, I suggest reading the <a href="http://www.w3schools.com/xml/">W3 Schools XML tutorial</a>.
    </p>
    <h2>
      XML graph file syntax
    </h2>
    <p>
      Here is the simplest useful graph template. It plots the external temperature for the last 24 hours.
    </p>
<pre>
&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;graph&gt;
  &lt;plot&gt;
    &lt;subplot&gt;
      &lt;title&gt;Temperature (&deg;C)&lt;/title&gt;
      &lt;ycalc&gt;data['temp_out']&lt;/ycalc&gt;
    &lt;/subplot&gt;
  &lt;/plot&gt;
&lt;/graph&gt;
</pre>
    <p>
      In this example, the root element <code>graph</code> has one <code>plot</code> element, which has one <code>subplot</code> element. The <code>subplot</code> element contains a <code>title</code> element and a <code>ycalc</code> element. To plot more data on the same set of axes (for example dew point and temperature), we can add more <code>subplot</code> elements. To plot more than one set of axes (for example wind speed is measured in different units from temperature) in the same file we can add more <code>plot</code> elements.
    </p>
    <p>
	The complete element hierarchy is shown below. Each element name links to a full description of that element.
    </p>
    <ul>
      <li>
        <a name="list"></a><a href="#graph">graph</a>
        <ul>
          <li>
            <a href="#plot">plot</a>
			<ul>
			  <li>
                <a href="#subplot">subplot</a>
				<ul>
				  <li>
                    <a href="#xcalc">xcalc</a>
				  </li>
				  <li>
                    <a href="#ycalc">ycalc</a>
				  </li>
				  <li>
                    <a href="#style">style</a>
				  </li>
				  <li>
                    <a href="#colour">colour</a>
				  </li>
				  <li>
                    <a href="#title">title</a>
				  </li>
				</ul>
			  </li>
			  <li>
                <a href="#yrange">yrange</a>
			  </li>
			  <li>
                <a href="#grid">grid</a>
			  </li>
			  <li>
                <a href="#source">source</a>
			  </li>
			  <li>
                <a href="#boxwidth">boxwidth</a>
			  </li>
			</ul>
          </li>
          <li>
            <a href="#start">start</a>
          </li>
          <li>
            <a href="#stop">stop</a>
          </li>
          <li>
            <a href="#duration">duration</a>
          </li>
          <li>
            <a href="#size">size</a>
          </li>
          <li>
            <a href="#lmargin">lmargin</a>
          </li>
          <li>
            <a href="#xformat">xformat</a>
          </li>
          <li>
            <a href="#xlabel">xlabel</a>
          </li>
          <li>
            <a href="#dateformat">dateformat</a>
          </li>
          <li>
            <a href="#xtics">xtics</a>
          </li>
        </ul>
      </li>
    </ul>
    <h3>
      <a href="#list" name="graph">graph</a>
    </h3>
    <p>
      This is the root element of the graph XML file. It does not have to be called "graph", but there must be exactly one root element.
    </p>
    <h3>
      <a href="#list" name="plot">plot</a>
    </h3>
    <p>
      Every graph element should contain at least one plot element. A separate graph is drawn for each plot element, but all share the same X axis.
    </p>
    <h3>
      <a href="#list" name="start">start</a>
    </h3>
    <p>
	This element sets the date &amp; time of the start of the X axis. It is used in the constructor of a Python <a href="auto/datetime.html#datetime">datetime</a> object. For example, to start the graph at noon (local time) on Christmas day: <code>&lt;start&gt;year=2008, month=12, day=25, hour=12&lt;/start&gt;</code>. The default value is <code>(stop - duration)</code>.
    </p>
    <h3>
      <a href="#list" name="stop">stop</a>
    </h3>
    <p>
	This element sets the date &amp; time of the end of the X axis. It is used in the constructor of a Python <a href="auto/datetime.html#datetime">datetime</a> object. For example, to end the graph at 10 am (local time) on new year's day: <code>&lt;stop&gt;year=2009, month=1, day=1, hour=10&lt;/stop&gt;</code>. The default value is <code>(start + duration)</code>, unless <code>start</code> is not defined in which case the timestamp of the latest weather station hourly reading is used.
    </p>
    <h3>
      <a href="#list" name="duration">duration</a>
    </h3>
    <p>
	This element sets the extent of the X axis of the graph, unless both <code>start</code> and <code>stop</code> are defined. It is used in the constructor of a Python <a href="auto/datetime.html#timedelta">timedelta</a> object. For example, to plot one week: <code>&lt;duration&gt;weeks=1&lt;/duration&gt;</code>. The default value is <code>hours=24</code>.
    </p>
    <h3>
      <a href="#list" name="size">size</a>
    </h3>
	<p>
	Sets the overall dimensions of the image file containing the graph. Default is a width of 600 pixels and height of 200 pixels for each plot, so a graph with four plot elements would be 600 x 800 pixels. Any <code>size</code> element must include both width and height. For example: <code>&lt;size&gt;800, 600&lt;/size&gt;</code> will produce an image 800 pixels wide and 600 pixels high.
    </p>
    <h3>
      <a href="#list" name="lmargin">lmargin</a>
    </h3>
    <p>
	Sets the left margin of the plots, i.e. the distance from the left hand axis to the left hand edge of the image area. According to the gnuplot documentation the units of <code>lmargin</code> are character widths. The default value is 5, which should look OK in most circumstances.
    </p>
    <h3>
      <a href="#list" name="xformat">xformat</a>
    </h3>
    <p>
	Sets the format of the time / date xtic labels. The value is a <code>strftime</code> style format string. Default depends on the graph <code>duration</code>: 24 hours or less is <code>"%H%M"</code>, 24 hours to 7 days is <code>"%a %d"</code> and 7 days or more is <code>"%Y/%m/%d"</code>.
    </p>
    <h3>
      <a href="#list" name="xlabel">xlabel</a>
    </h3>
    <p>
	Sets the X axis label. The value is a <code>strftime</code> style format string. Default depends on the graph <code>duration</code>: 24 hours or less is <code>"Time (%Z)"</code>, 24 hours to 7 days is <code>"Day"</code> and 7 days or more is <code>"Date"</code>. The <a href="auto/datetime.html#datetime">datetime</a> used to compute this is <code>start</code>, which may produce unexpected results when a graph spans DST start or end.
    </p>
    <h3>
      <a href="#list" name="dateformat">dateformat</a>
    </h3>
    <p>
	Sets the format of the date labels at each end of X axis. The value is a <code>strftime</code> style format string. Default is <code>"%Y/%m/%d"</code>. The right hand label is only drawn if it differs from the left. To have no labels, set an empty format: <code>&lt;dateformat&gt;&lt;/dateformat&gt;</code>
    </p>
    <h3>
      <a href="#list" name="xtics">xtics</a>
    </h3>
    <p>
	Sets the spacing of the "tic" marks on the X axis. The value is an integer number of hours. The default is to allow gnuplot to set an appropriate interval.
    </p>
    <h3>
      <a href="#list" name="subplot">subplot</a>
    </h3>
    <p>
      Every plot element should contain at least one subplot element. A separate trace is drawn for each subplot element, but all share the same X and Y axes.
    </p>
    <h3>
      <a href="#list" name="yrange">yrange</a>
    </h3>
    <p>
	Sets the lower and upper limits of the Y axis. The value is a pair of numbers. The default is to allow gnuplot to set appropriate values, which is unlikely to be what you want. For example, to plot typical UK temperatures with no value going off the graph: <code>&lt;yrange&gt;-10, 30&lt;/yrange&gt;</code>.
    </p>
    <h3>
      <a href="#list" name="grid">grid</a>
    </h3>
    <p>
	Adds a grid to the plot. In most situations gnuplot's default grid is suitable, so no value is needed: <code>&lt;grid&gt;&lt;/grid&gt;</code>. More control is possible using any of the options understood by <a href="http://www.gnuplot.info/docs/node188.html">gnuplot's <code>set grid</code> command</a>. For example, to have horizontal grid lines only: <code>&lt;grid&gt;ytics&lt;/grid&gt;</code>.
    </p>
    <h3>
      <a href="#list" name="source">source</a>
    </h3>
    <p>
	Select the weather data to be plotted. Permitted values are <code>&lt;source&gt;raw&lt;/source&gt;</code>, <code>&lt;source&gt;hourly&lt;/source&gt;</code>, <code>&lt;source&gt;daily&lt;/source&gt;</code> and <code>&lt;source&gt;monthly&lt;/source&gt;</code>. Default is <code>raw</code>. Note that the different sources have different data dictionaries, so this choice affects <code>ycalc</code>.
    </p>
    <h3>
      <a href="#list" name="boxwidth">boxwidth</a>
    </h3>
    <p>
	Sets the width of the "boxes" used when drawing bar graphs. The value is an integer expression yielding a number of seconds. Default depends on <code>source</code>: raw is 240, hourly is 2800 and daily is 2800 * 24.
    </p>
    <h3>
      <a href="#list" name="xcalc">xcalc</a>
    </h3>
    <p>
	Controls the X axis positioning of plotted data values. The default value of <code>data['idx']</code> is correct for most data, but there are some exceptions. For example, when plotting bar charts of hourly rainfall, it's nice to centre the bars on 30 minutes past the hour: <code>&lt;xcalc&gt;data['idx'].replace(minute=30, second=0)&lt;/xcalc&gt;</code>.
    </p>
    <h3>
      <a href="#list" name="ycalc">ycalc</a>
    </h3>
    <p>
	Selects the data to be plotted. Any one line Python expression that returns a single float value can be used. At its simplest this just selects one value from the "data" dictionary, for example: <code>&lt;ycalc&gt;data['temp_out']&lt;/ycalc&gt;</code> plots the external temperature. More complex expressions are possible, and some helper functions are provided. For example: <code>&lt;ycalc&gt;dew_point(data['temp_out'], data['hum_out'])&lt;/ycalc&gt;</code> plots the external dew point, and <code>&lt;ycalc&gt;data['wind_ave'] * 3.6 / 1.609344&lt;/ycalc&gt;</code> plots the average wind speed in miles per hour.
    </p>
    <h3>
      <a href="#list" name="style">style</a>
    </h3>
    <p>
	Sets the line style for the graph. Default is a smooth continuous line. To select a bar graph use: <code>&lt;style&gt;box&lt;/style&gt;</code>.
    </p>
    <h3>
      <a href="#list" name="colour">colour</a>
    </h3>
    <p>
	Sets the colour of the subplot line or boxes. Any integer value is accepted. The mapping of colours to numbers is set by <a href="http://www.gnuplot.info/">gnuplot</a>. Default value is the previous colour plus one.
    </p>
    <h3>
      <a href="#list" name="title">title</a>
    </h3>
    <p>
	Sets the title of the subplot. A single line of text, for example: <code>&lt;title&gt;Temperature (&deg;C)&lt;/title&gt;</code>. This title appears within the plot area, next to a short segment of the line colour used for the subplot.
    </p>
    <hr>
    <p>
      <a href="http://code.google.com/p/pywws/"><i>Python software for USB Wireless WeatherStations</i></a> &copy; <a href="http://www.jim-easterbrook.me.uk/">Jim Easterbrook</a>.
    </p>
  </body>
</html>

