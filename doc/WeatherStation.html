<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
  <head>
    <title>
      Software for WeatherStations: WeatherStation.py
    </title>
  </head>
  <body>
    <h1>
      <a href="index.html">Python software for USB Wireless WeatherStations</a>
    </h1>
    <h2>
      <a href="auto/WeatherStation.html">WeatherStation.py</a> -- gets data from the weather station
    </h2>
    <p>
      This is the module that actually talks to the weather station base unit. I don't have much understanding of USB, so copied a lot from <a href="http://www.pendec.dk/weatherstation2007.htm">Michael Pendec's C program wwsr</a>. This module only reads data from the station (in 32 byte chunks). It does not attempt to write to the station, e.g. to set alarms or reset min/max values.
    </p>
    <p>
      The weather station memory has two parts: a "fixed block" of 256 bytes and a circular buffer of 65280 bytes. As each weather reading takes 16 bytes the station can store 4080 readings, or 14 days of 5-minute interval readings. As data is read in 32-byte chunks, but each weather reading is 16 bytes, a small cache is used to reduce USB traffic. The caching behaviour can be over-ridden with the <code>unbuffered</code> parameter to <code>get_data</code> and <code>get_raw_data</code>.
    </p>
    <p>
      Decoding the data is controlled by the static dictionaries <code>reading_format</code>, <code>lo_fix_format</code> and <code>fixed_format</code>. The keys are names of data items and the values can be an (offset, type and multiplier) tuple or another dictionary. So, for example, the <code>reading_format</code> dictionary entry <code>'rain' : (13, 'us', 0.3)</code> means that the rain value is an unsigned short (two bytes), 13 bytes from the start of the block, and should be multiplied by 0.3 to get a useful value.
    </p>
    <p>
      The use of nested dictionaries in the <code>fixed_format</code> dictionary allows useful subsets of data to be decoded. For example, to decode the entire block <code>get_fixed_block</code> is called with no parameters:
    </p>
<pre>
ws = WeatherStation.weather_station()
print ws.get_fixed_block()
</pre>
    <p>
      To get the stored minimum external temperature, <code>get_fixed_block</code> is called with a sequence of keys:
    </p>
<pre>
ws = WeatherStation.weather_station()
print ws.get_fixed_block(['min', 'temp_out', 'val'])
</pre>
    <p>
      Often there is no requirement to read and decode the entire fixed block, as its first 64 bytes contain the most useful data: the interval between stored readings, the buffer address where the current reading is stored, and the current date &amp; time. The <code>get_lo_fix_block</code> provides easy access to these.
    </p>
    <p>
      For more examples of using the WeatherStation module, see the <a href="TestWeatherStation.html">TestWeatherStation</a> program.
    </p>
    <hr>
    <p>
      <a href="http://code.google.com/p/pywws/"><i>Python software for USB Wireless WeatherStations</i></a> &copy; <a href="http://www.jim-easterbrook.me.uk/">Jim Easterbrook</a>.
    </p>
  </body>
</html>